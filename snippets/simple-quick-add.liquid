<button
  class="quick-add-simple"
  data-product-handle="{{ product.handle }}"
  aria-label="Add {{ product.title }} to cart"
>
  <span class="quick-add-simple__icon">
    {{ 'icon-add-to-cart.svg' | inline_asset_content }}
  </span>
  <span class="quick-add-simple__text">Add</span>
</button>

<style>
.product-image-slider { position: relative; }

.quick-add-simple {
  position: absolute;
  bottom: 10px;
  right: 10px;
  z-index: 20;
  display: flex;
  align-items: center;
  gap: 6px;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 999px;
  padding: 8px 10px;
  cursor: pointer;
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  transform: translateY(6px);
  transition: opacity .2s ease, transform .2s ease;
}

.product-image-slider:hover .quick-add-simple {
  opacity: 1;
  visibility: visible;
  pointer-events: all;
  transform: translateY(0);
}

.quick-add-simple__icon svg { width: 16px; height: 16px; }

.quick-add-simple__text {
  font-size: 14px;
  white-space: nowrap;
  max-width: 0;
  overflow: hidden;
  opacity: 0;
  transition: max-width .25s ease, opacity .2s ease;
}

.quick-add-simple:hover .quick-add-simple__text {
  max-width: 50px;
  opacity: 1;
}

.quick-add-simple.added {
  pointer-events: none;
  opacity: 0.6;
}
</style>

<script>
document.addEventListener('click', async function(e) {
  const button = e.target.closest('.quick-add-simple');
  if (!button) return;

  e.preventDefault();
  e.stopImmediatePropagation(); // Prevent duplicate triggers

  if (button.disabled) return; // Prevent double clicks
  button.disabled = true;

  const handle = button.dataset.productHandle;
  if (!handle) return;

  button.classList.add('loading');

  try {
    // Fetch product JSON to get first available variant
    const productData = await fetch(`/products/${handle}.js`).then(r => r.json());
    const variant = productData.variants.find(v => v.available);
    if (!variant) {
      console.warn('No available variant for', handle);
      button.disabled = false;
      return;
    }

    // Add exactly 1 to cart
    await fetch('/cart/add.js', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ id: variant.id, quantity: 1 })
    });

    // Optional: visual feedback
    button.classList.add('added');
    setTimeout(() => {
      button.classList.remove('added');
      button.disabled = false; // Re-enable after animation
    }, 1500);

    // Update cart count in header
    const cartCountEls = document.querySelectorAll('.cart-count-bubble, .header__cart-count');
    if (cartCountEls.length) {
      const cart = await fetch('/cart.js').then(r => r.json());
      cartCountEls.forEach(el => el.textContent = cart.item_count);
    }

  } catch(err) {
    console.error('Quick add failed', err);
    button.disabled = false;
  }
});
</script>
