{% doc %}
  @prompt
    Create a flexible container block with comprehensive grid layout settings that can hold other blocks inside it. The container should include settings for: grid columns (responsive for mobile, tablet, desktop), gap/spacing between items, alignment options (horizontal and vertical), and padding controls. The block should appear in the theme editor's block picker and allow merchants to add any other blocks as children inside this grid container. Include visual controls for grid template columns, rows, and responsive breakpoints.
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-grid-container-{{ ai_gen_id }} {
    display: block;
    width: 100%;
    box-sizing: border-box;
  }

  .ai-grid-container__wrapper-{{ ai_gen_id }} {
    display: grid;
    width: 100%;
    gap: {{ block.settings.gap_mobile }}px;
    padding: {{ block.settings.padding_top_mobile }}px {{ block.settings.padding_horizontal_mobile }}px {{ block.settings.padding_bottom_mobile }}px;
    grid-template-columns: repeat({{ block.settings.columns_mobile }}, 1fr);
    justify-items: {{ block.settings.horizontal_alignment }};
    align-items: {{ block.settings.vertical_alignment }};
    background-color: {{ block.settings.background_color }};
    border-radius: {{ block.settings.border_radius }}px;
  }

  {% if block.settings.min_item_width > 0 %}
    .ai-grid-container__wrapper-{{ ai_gen_id }} {
      grid-template-columns: repeat(auto-fit, minmax({{ block.settings.min_item_width }}px, 1fr));
    }
  {% endif %}

  @media screen and (min-width: 750px) {
    .ai-grid-container__wrapper-{{ ai_gen_id }} {
      gap: {{ block.settings.gap_tablet }}px;
      padding: {{ block.settings.padding_top_tablet }}px {{ block.settings.padding_horizontal_tablet }}px {{ block.settings.padding_bottom_tablet }}px;
      grid-template-columns: repeat({{ block.settings.columns_tablet }}, 1fr);
    }

    {% if block.settings.min_item_width > 0 %}
      .ai-grid-container__wrapper-{{ ai_gen_id }} {
        grid-template-columns: repeat(auto-fit, minmax({{ block.settings.min_item_width }}px, 1fr));
      }
    {% endif %}
  }

  @media screen and (min-width: 990px) {
    .ai-grid-container__wrapper-{{ ai_gen_id }} {
      gap: {{ block.settings.gap_desktop }}px;
      padding: {{ block.settings.padding_top_desktop }}px {{ block.settings.padding_horizontal_desktop }}px {{ block.settings.padding_bottom_desktop }}px;
      grid-template-columns: repeat({{ block.settings.columns_desktop }}, 1fr);
    }

    {% if block.settings.min_item_width > 0 %}
      .ai-grid-container__wrapper-{{ ai_gen_id }} {
        grid-template-columns: repeat(auto-fit, minmax({{ block.settings.min_item_width }}px, 1fr));
      }
    {% endif %}
  }

  .ai-grid-container__item-{{ ai_gen_id }} {
    width: 100%;
  }

  {% if block.settings.show_border %}
    .ai-grid-container__wrapper-{{ ai_gen_id }} {
      border: {{ block.settings.border_width }}px solid {{ block.settings.border_color }};
    }
  {% endif %}

  .ai-grid-container__empty-state-{{ ai_gen_id }} {
    grid-column: 1 / -1;
    padding: 40px 20px;
    text-align: center;
    color: #666;
    background-color: #f9f9f9;
    border: 2px dashed #ddd;
    border-radius: 8px;
  }

  .ai-grid-container__empty-state-title-{{ ai_gen_id }} {
    font-size: 18px;
    font-weight: 600;
    margin: 0 0 8px;
    color: #333;
  }

  .ai-grid-container__empty-state-text-{{ ai_gen_id }} {
    font-size: 14px;
    margin: 0;
  }
{% endstyle %}

<grid-container-{{ ai_gen_id }}
  class="ai-grid-container-{{ ai_gen_id }}"
  {{ block.shopify_attributes }}
>
  <div class="ai-grid-container__wrapper-{{ ai_gen_id }}">
    {% if block.blocks.size > 0 %}
      {% for child_block in block.blocks %}
        <div class="ai-grid-container__item-{{ ai_gen_id }}">
          {% render block: child_block %}
        </div>
      {% endfor %}
    {% else %}
      <div class="ai-grid-container__empty-state-{{ ai_gen_id }}">
        <h3 class="ai-grid-container__empty-state-title-{{ ai_gen_id }}">Grid container is ready</h3>
        <p class="ai-grid-container__empty-state-text-{{ ai_gen_id }}">Add blocks inside this container to see them arranged in a grid layout</p>
      </div>
    {% endif %}
  </div>
</grid-container-{{ ai_gen_id }}>

<script>
  (function() {
    class GridContainer{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
      }

      connectedCallback() {
        this.observeChildChanges();
      }

      observeChildChanges() {
        const wrapper = this.querySelector('.ai-grid-container__wrapper-{{ ai_gen_id }}');
        if (!wrapper) return;

        const observer = new MutationObserver(() => {
          this.updateEmptyState();
        });

        observer.observe(wrapper, {
          childList: true,
          subtree: true
        });

        this.updateEmptyState();
      }

      updateEmptyState() {
        const wrapper = this.querySelector('.ai-grid-container__wrapper-{{ ai_gen_id }}');
        const emptyState = this.querySelector('.ai-grid-container__empty-state-{{ ai_gen_id }}');
        const items = this.querySelectorAll('.ai-grid-container__item-{{ ai_gen_id }}');

        if (items.length === 0 && !emptyState) {
          const emptyStateEl = document.createElement('div');
          emptyStateEl.className = 'ai-grid-container__empty-state-{{ ai_gen_id }}';
          emptyStateEl.innerHTML = '<h3 class="ai-grid-container__empty-state-title-{{ ai_gen_id }}">Grid container is ready</h3><p class="ai-grid-container__empty-state-text-{{ ai_gen_id }}">Add blocks inside this container to see them arranged in a grid layout</p>';
          wrapper.appendChild(emptyStateEl);
        } else if (items.length > 0 && emptyState) {
          emptyState.remove();
        }
      }
    }

    customElements.define('grid-container-{{ ai_gen_id }}', GridContainer{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Grid container",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Grid columns"
    },
    {
      "type": "range",
      "id": "columns_mobile",
      "label": "Mobile columns",
      "min": 1,
      "max": 3,
      "step": 1,
      "default": 1
    },
    {
      "type": "range",
      "id": "columns_tablet",
      "label": "Tablet columns",
      "min": 1,
      "max": 6,
      "step": 1,
      "default": 2
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "label": "Desktop columns",
      "min": 1,
      "max": 12,
      "step": 1,
      "default": 3
    },
    {
      "type": "range",
      "id": "min_item_width",
      "label": "Minimum item width",
      "min": 0,
      "max": 500,
      "step": 10,
      "unit": "px",
      "default": 0,
      "info": "Set to 0 to use fixed columns. When set, items will automatically wrap based on this minimum width."
    },
    {
      "type": "header",
      "content": "Spacing"
    },
    {
      "type": "range",
      "id": "gap_mobile",
      "label": "Mobile gap",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 16
    },
    {
      "type": "range",
      "id": "gap_tablet",
      "label": "Tablet gap",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 20
    },
    {
      "type": "range",
      "id": "gap_desktop",
      "label": "Desktop gap",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 24
    },
    {
      "type": "header",
      "content": "Alignment"
    },
    {
      "type": "select",
      "id": "horizontal_alignment",
      "label": "Horizontal alignment",
      "options": [
        {
          "value": "start",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "end",
          "label": "Right"
        },
        {
          "value": "stretch",
          "label": "Stretch"
        }
      ],
      "default": "stretch"
    },
    {
      "type": "select",
      "id": "vertical_alignment",
      "label": "Vertical alignment",
      "options": [
        {
          "value": "start",
          "label": "Top"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "end",
          "label": "Bottom"
        },
        {
          "value": "stretch",
          "label": "Stretch"
        }
      ],
      "default": "start"
    },
    {
      "type": "header",
      "content": "Padding - Mobile"
    },
    {
      "type": "range",
      "id": "padding_top_mobile",
      "label": "Top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 20
    },
    {
      "type": "range",
      "id": "padding_bottom_mobile",
      "label": "Bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 20
    },
    {
      "type": "range",
      "id": "padding_horizontal_mobile",
      "label": "Horizontal",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 16
    },
    {
      "type": "header",
      "content": "Padding - Tablet"
    },
    {
      "type": "range",
      "id": "padding_top_tablet",
      "label": "Top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 32
    },
    {
      "type": "range",
      "id": "padding_bottom_tablet",
      "label": "Bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 32
    },
    {
      "type": "range",
      "id": "padding_horizontal_tablet",
      "label": "Horizontal",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 24
    },
    {
      "type": "header",
      "content": "Padding - Desktop"
    },
    {
      "type": "range",
      "id": "padding_top_desktop",
      "label": "Top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 40
    },
    {
      "type": "range",
      "id": "padding_bottom_desktop",
      "label": "Bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 40
    },
    {
      "type": "range",
      "id": "padding_horizontal_desktop",
      "label": "Horizontal",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 32
    },
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "rgba(0,0,0,0)"
    },
    {
      "type": "checkbox",
      "id": "show_border",
      "label": "Show border",
      "default": false
    },
    {
      "type": "range",
      "id": "border_width",
      "label": "Border width",
      "min": 1,
      "max": 10,
      "step": 1,
      "unit": "px",
      "default": 1
    },
    {
      "type": "color",
      "id": "border_color",
      "label": "Border color",
      "default": "#e6e6e6"
    },
    {
      "type": "range",
      "id": "border_radius",
      "label": "Border radius",
      "min": 0,
      "max": 40,
      "step": 4,
      "unit": "px",
      "default": 0
    }
  ],
  "blocks": [
    {
      "type": "@app"
    },
    {
      "type": "image"
    },
    {
      "type": "text"
    },
    {
      "type": "heading"
    },
    {
      "type": "button"
    },
    {
      "type": "video"
    }
  ],
  "presets": [
    {
      "name": "Grid container"
    }
  ]
}
{% endschema %}